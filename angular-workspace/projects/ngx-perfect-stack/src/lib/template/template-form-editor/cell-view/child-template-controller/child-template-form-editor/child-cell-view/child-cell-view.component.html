<div class="wrapper">
  <div class="p-2 cell-highlight hover-highlight" draggable droppable (onDrop)="onItemDrop($event)">
    <div class="row">
      <div class="col-12" [ngStyle]="{'min-height': getCSSHeight(cell)}">
        <ng-container *ngIf="attribute">
          <label [for]="attribute.name">
            <span placement="right" [ngbTooltip]="attribute.description">{{attribute.label}}</span>
          </label>

          <div [ngSwitch]="attribute.type">
            <ng-container *ngSwitchCase="'Date'">
              <app-date-picker-control [formGroup]="entityForm" [name]="attribute.name"></app-date-picker-control>
            </ng-container>

            <ng-container *ngSwitchCase="['Text', 'Html'].includes(attribute.type) ? attribute.type : ''">
              <ng-container [ngSwitch]="cell.component">
                <ng-container *ngSwitchCase="'TextArea'">
                  <app-text-area-control [cell]="cell" [formGroup]="entityForm" [attribute]="attribute"></app-text-area-control>
                </ng-container>

                <ng-container *ngSwitchDefault>
                  <lib-text-field-control [formGroup]="entityForm" [name]="attribute.name"></lib-text-field-control>
                </ng-container>
              </ng-container>
            </ng-container>

            <ng-container *ngSwitchCase="'OneToMany'">
              <ng-container *ngIf="cell.template">
                <!--<app-template-controller [template]="cell.template"></app-template-controller>-->
                <<!--lib-child-template-controller [template]="cell.template"></lib-child-template-controller>-->
                WARNING: can't add a OneToMany to a child relationship.
              </ng-container>
            </ng-container>

            <ng-container *ngSwitchCase="'OneToOne'">
              <ng-container *ngIf="cell.template">
                <!--<app-template-controller [template]="cell.template"></app-template-controller>-->
                <!--<lib-child-template-controller [template]="cell.template"></lib-child-template-controller>-->
                WARNING: can't add a OneToOne to a child relationship.
              </ng-container>
            </ng-container>

            <ng-container *ngSwitchCase="'ManyToOne'">
              <ng-container [ngSwitch]="cell.component">
                <ng-container *ngSwitchCase="'Select'">
                  <app-select-control [formGroup]="entityForm" [attribute]="attribute"></app-select-control>
                </ng-container>

                <ng-container *ngSwitchDefault>
                  <app-many-to-one-control [formGroup]="entityForm" [mode]="'edit'" [attribute]="attribute"></app-many-to-one-control>
                </ng-container>
              </ng-container>
            </ng-container>

            <ng-container *ngSwitchDefault>
              ERROR: Missing or unknown attribute type of: "{{attribute.type}}"
            </ng-container>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <ng-container *ngIf="mouseActive">
    <div class="overlay-top-right p-1">
      <span class="material-icons hover-highlight no_selection" (click)="onChangeWidth(-1, $event)">remove_circle_outline</span>
      <span class="material-icons hover-highlight no_selection" (click)="onChangeWidth(1, $event)">add_circle_outline</span>
    </div>
  </ng-container>

  <ng-container *ngIf="mouseActive">
    <div class="overlay-bottom-left p-1">
      <span class="material-icons hover-highlight no_selection" (click)="onSettings(settingsTemplate)">settings</span>
      <span class="material-icons hover-highlight no_selection" (click)="onDeleteCell()">highlight_off</span>
      <span class="material-icons hover-highlight no_selection" (click)="onClearCell()">block</span>
    </div>
  </ng-container>

  <ng-container *ngIf="mouseActive">
    <div class="d-flex flex-column overlay-bottom-right p-1">
      <span class="material-icons hover-highlight no_selection" (click)="onChangeHeight(-1)">remove_circle_outline</span>
      <span class="material-icons hover-highlight no_selection" (click)="onChangeHeight(1)">add_circle_outline</span>
    </div>
  </ng-container>

</div>


<ng-template #settingsTemplate let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Cell Settings</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form>
      <div class="form-group">
        <label for="componentType">Component type</label>
        <div class="input-group">
          <select id="componentType" class="form-control" name="component" [(ngModel)]="cell.component">
            <option *ngFor="let o of getComponentTypeOptions()" [ngValue]="o">{{o}}</option>
          </select>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close('ok click')">Ok</button>
  </div>
</ng-template>
