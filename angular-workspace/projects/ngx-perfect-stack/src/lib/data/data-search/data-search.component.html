<div class="container-fluid container-page" *ngIf="ctx$ | async as ctx">

  <ng-container *ngIf="searchCriteriaTemplate">
    <div class="d-flex justify-content-between">
      <div>
        <h3>{{ctx.metaPage.title}}</h3>
      </div>
      <div>
        <ng-container *ngIf="!(searchCriteriaTemplate.locations && searchCriteriaTemplate.locations['OuterTopRight'])">
          <button type="button" class="btn btn-success" (click)="onNew(ctx)" id="newBtn">{{newButtonLbl}}</button>
        </ng-container>
        <ng-container *ngIf="searchCriteriaTemplate.locations && searchCriteriaTemplate.locations['OuterTopRight']">
          <lib-tool-view [ctx]="ctx" [tool]="searchCriteriaTemplate.locations['OuterTopRight']"></lib-tool-view>
        </ng-container>
      </div>
    </div>

    <!-- The *ngIf here is important because it triggers the redisplay of the criteria when the route changes. There's
    an indirect dependency here between the route changing, the search criteria form changing and a new search being done -->
    <form class="container-fluid container-form" *ngIf="searchResultsFormGroup">
      <lib-controller [ctx]="ctx" [template]="searchCriteriaTemplate">
        <ng-container BottomLeftActions>
        </ng-container>
        <ng-container BottomRightActions>
          <button type="button" class="btn btn-outline-primary me-2" (click)="onReset(ctx)" id="resetBtn">Reset</button>
          <button type="submit" class="btn btn-primary" (click)="onSearch(ctx)" id="searchBtn">Search</button>
        </ng-container>
      </lib-controller>
    </form>
  </ng-container>

  <div class="container-table" *ngIf="searchResultsFormGroup">

    <div class="collection-size-found">
      {{collectionSize}} {{this.resultTableMetaEntity.pluralName}} found
    </div>

    <ng-container *ngIf="searchResultsFormGroup">
      <lib-table-layout
        [ctx]="ctx"
        [template]="resultTableTemplate"
        [mode]="'view'"
        [relationshipProperty]="'results'">
      </lib-table-layout>
    </ng-container>


    <ngb-pagination class="d-flex justify-content-center" [collectionSize]="collectionSize" [maxSize]="5" [(page)]="pageNumber" [pageSize]="pageSize" (pageChange)="onSearch(ctx)">
      <ng-template ngbPaginationFirst>First</ng-template>
      <ng-template ngbPaginationLast>Last</ng-template>
      <ng-template ngbPaginationPrevious>Previous</ng-template>
      <ng-template ngbPaginationNext>Next</ng-template>
      <ng-template ngbPaginationEllipsis>...</ng-template>
      <ng-template ngbPaginationNumber let-page>{{ page }}</ng-template>
    </ngb-pagination>
  </div>

  <lib-version [style]="'Footer'"></lib-version>
</div>
