<ng-container *ngIf="cells$ | async as cells">

  <!-- If "old" way, OR "new" way and template has a binding to the form -->
  <ng-container *ngIf="!(ctx && ctx.formMap && !template.binding)">
    <div [formGroup]="formGroup">
      <div class="row" *ngFor="let row of cells">
        <div [class]="getCSS(cell)" class="mt-3" *ngFor="let cell of row">

            <ng-container *ngIf="cell.attribute">
              <lib-label [mode]="mode" [metaEntity]="metaEntity" [cell]="cell" [attribute]="cell.attribute"></lib-label>
              <lib-cell [mode]="mode" [cell]="cell" [formGroup]="formGroup"></lib-cell>
            </ng-container>

          <ng-container *ngIf="cell.tool">
            <lib-tool-view [tool]="cell.tool"></lib-tool-view>
          </ng-container>

        </div>
      </div>
    </div>
  </ng-container>

  <!-- If "new" way and this template doesn't have a binding (normally this means it's a root level template with nested child templates, so no binding means no form group) -->
  <ng-container *ngIf="ctx && ctx.formMap && !template.binding">
    <div [formGroup]="formGroup">
      <div class="row" *ngFor="let row of cells">
        <div [class]="getCSS(cell)" *ngFor="let cell of row">
          <div class="p-3 bg-light shadow-sm border" *ngIf="cell.template">
            <lib-layout [ctx]="ctx" [template]="cell.template"></lib-layout>
          </div>
        </div>
      </div>
    </div>
  </ng-container>


</ng-container>
