<ng-container *ngIf="{
   metaEntity: metaEntity$ | async,
   entity: entity$ | async
} as context">

  <div *ngIf="!context.metaEntity; else EditEntity">
    Loading...
  </div>

  <ng-template #EditEntity>
    <ng-container *ngIf="context.entity">

      <div class="container-fluid mt-3">
        <h2 class="mb-3">{{context.metaEntity?.name}} Edit</h2>

        <form class="form" #form="ngForm" [formGroup]="entityForm" (ngSubmit)="onSubmit()">
          <ng-container *ngFor="let attribute of context.metaEntity?.attributes">

            <ng-container *ngIf="attribute.visibility !== 'Hidden'">
              <div class="form-group">

                <label [for]="attribute.name">
                  <span placement="right" [ngbTooltip]="attribute.description">{{attribute.label}}</span>
                </label>

                <div [ngSwitch]="attribute.type">
                  <ng-container *ngSwitchCase="'Date'">
                    <app-date-picker-control [formGroup]="entityForm" [attribute]="attribute"></app-date-picker-control>
                  </ng-container>

                  <ng-container *ngSwitchCase="'Text'">
                    <app-text-field-control [formGroup]="entityForm" [attribute]="attribute"></app-text-field-control>
                  </ng-container>

                  <ng-container *ngSwitchDefault>
                    ERROR: Missing or unknown attribute type of: "{{attribute.type}}"
                  </ng-container>
                </div>
              </div>
            </ng-container>

          </ng-container>

          <button type="submit" class="btn btn-primary mr-2">Save</button>
          <button class="btn btn-outline-secondary" (click)="onCancel()">Cancel</button>
        </form>

      </div>

    </ng-container>
  </ng-template>

</ng-container>




